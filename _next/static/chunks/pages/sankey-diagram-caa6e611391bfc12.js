(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5654],{30953:function(e,t,n){"use strict";function r(e,t){let n;if(void 0===t)for(let t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}n.d(t,{Z:function(){return r}})},57929:function(e,t,n){"use strict";n.d(t,{PT:function(){return o},be:function(){return a}});var r=n(30953);function i(e){return e.target.depth}function o(e,t){return e.sourceLinks.length?e.depth:t-1}function a(e){return e.targetLinks.length?e.depth:e.sourceLinks.length?(0,r.Z)(e.sourceLinks,i)-1:0}},94091:function(e,t,n){"use strict";function r(e,t){let n=0;if(void 0===t)for(let t of e)(t=+t)&&(n+=t);else{let r=-1;for(let i of e)(i=+t(i,++r,e))&&(n+=i)}return n}function i(e,t){let n;if(void 0===t)for(let t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}n.d(t,{Z:function(){return p}});var o=n(30953),a=n(57929);function s(e){return function(){return e}}function l(e,t){return d(e.source,t.source)||e.index-t.index}function c(e,t){return d(e.target,t.target)||e.index-t.index}function d(e,t){return e.y0-t.y0}function h(e){return e.value}function u(e){return e.index}function g(e){return e.nodes}function f(e){return e.links}function y(e,t){let n=e.get(t);if(!n)throw Error("missing: "+t);return n}function m({nodes:e}){for(let t of e){let e=t.y0,n=e;for(let n of t.sourceLinks)n.y0=e+n.width/2,e+=n.width;for(let e of t.targetLinks)e.y1=n+e.width/2,n+=e.width}}function p(){let e,t,n=0,p=0,x=1,v=1,j=24,k=8,w,b=u,_=a.PT,L=g,S=f,T=6;function E(){let a={nodes:L.apply(null,arguments),links:S.apply(null,arguments)};return function({nodes:e,links:n}){for(let[t,n]of e.entries())n.index=t,n.sourceLinks=[],n.targetLinks=[];let r=new Map(e.map((t,n)=>[b(t,n,e),t]));for(let[e,t]of n.entries()){t.index=e;let{source:n,target:i}=t;"object"!=typeof n&&(n=t.source=y(r,n)),"object"!=typeof i&&(i=t.target=y(r,i)),n.sourceLinks.push(t),i.targetLinks.push(t)}if(null!=t)for(let{sourceLinks:n,targetLinks:r}of e)n.sort(t),r.sort(t)}(a),function({nodes:e}){for(let t of e)t.value=void 0===t.fixedValue?Math.max(r(t.sourceLinks,h),r(t.targetLinks,h)):t.fixedValue}(a),function({nodes:e}){let t=e.length,n=new Set(e),r=new Set,i=0;for(;n.size;){for(let e of n)for(let{target:t}of(e.depth=i,e.sourceLinks))r.add(t);if(++i>t)throw Error("circular link");n=r,r=new Set}}(a),function({nodes:e}){let t=e.length,n=new Set(e),r=new Set,i=0;for(;n.size;){for(let e of n)for(let{source:t}of(e.height=i,e.targetLinks))r.add(t);if(++i>t)throw Error("circular link");n=r,r=new Set}}(a),function(a){let s=function({nodes:t}){let r=i(t,e=>e.depth)+1,o=(x-n-j)/(r-1),a=Array(r);for(let e of t){let t=Math.max(0,Math.min(r-1,Math.floor(_.call(null,e,r))));e.layer=t,e.x0=n+t*o,e.x1=e.x0+j,a[t]?a[t].push(e):a[t]=[e]}if(e)for(let t of a)t.sort(e);return a}(a);w=Math.min(k,(v-p)/(i(s,e=>e.length)-1)),function(e){let n=(0,o.Z)(e,e=>(v-p-(e.length-1)*w)/r(e,h));for(let r of e){let e=p;for(let t of r)for(let r of(t.y0=e,t.y1=e+t.value*n,e=t.y1+w,t.sourceLinks))r.width=r.value*n;e=(v-e+w)/(r.length+1);for(let t=0;t<r.length;++t){let n=r[t];n.y0+=e*(t+1),n.y1+=e*(t+1)}(function(e){if(void 0===t)for(let{sourceLinks:t,targetLinks:n}of e)t.sort(c),n.sort(l)})(r)}}(s);for(let t=0;t<T;++t){let n=Math.pow(.99,t),r=Math.max(1-n,(t+1)/T);(function(t,n,r){for(let i=t.length,o=i-2;o>=0;--o){let i=t[o];for(let e of i){let t=0,r=0;for(let{target:n,value:i}of e.sourceLinks){let o=i*(n.layer-e.layer);t+=function(e,t){let n=t.y0-(t.targetLinks.length-1)*w/2;for(let{source:r,width:i}of t.targetLinks){if(r===e)break;n+=i+w}for(let{target:r,width:i}of e.sourceLinks){if(r===t)break;n-=i}return n}(e,n)*o,r+=o}if(!(r>0))continue;let i=(t/r-e.y0)*n;e.y0+=i,e.y1+=i,H(e)}void 0===e&&i.sort(d),M(i,r)}})(s,n,r),function(t,n,r){for(let i=1,o=t.length;i<o;++i){let o=t[i];for(let e of o){let t=0,r=0;for(let{source:n,value:i}of e.targetLinks){let o=i*(e.layer-n.layer);t+=function(e,t){let n=e.y0-(e.sourceLinks.length-1)*w/2;for(let{target:r,width:i}of e.sourceLinks){if(r===t)break;n+=i+w}for(let{source:r,width:i}of t.targetLinks){if(r===e)break;n-=i}return n}(n,e)*o,r+=o}if(!(r>0))continue;let i=(t/r-e.y0)*n;e.y0+=i,e.y1+=i,H(e)}void 0===e&&o.sort(d),M(o,r)}}(s,n,r)}}(a),m(a),a}function M(e,t){let n=e.length>>1,r=e[n];D(e,r.y0-w,n-1,t),A(e,r.y1+w,n+1,t),D(e,v,e.length-1,t),A(e,p,0,t)}function A(e,t,n,r){for(;n<e.length;++n){let i=e[n],o=(t-i.y0)*r;o>1e-6&&(i.y0+=o,i.y1+=o),t=i.y1+w}}function D(e,t,n,r){for(;n>=0;--n){let i=e[n],o=(i.y1-t)*r;o>1e-6&&(i.y0-=o,i.y1-=o),t=i.y0-w}}function H({sourceLinks:e,targetLinks:n}){if(void 0===t){for(let{source:{sourceLinks:e}}of n)e.sort(c);for(let{target:{targetLinks:t}}of e)t.sort(l)}}return E.update=function(e){return m(e),e},E.nodeId=function(e){return arguments.length?(b="function"==typeof e?e:s(e),E):b},E.nodeAlign=function(e){return arguments.length?(_="function"==typeof e?e:s(e),E):_},E.nodeSort=function(t){return arguments.length?(e=t,E):e},E.nodeWidth=function(e){return arguments.length?(j=+e,E):j},E.nodePadding=function(e){return arguments.length?(k=w=+e,E):k},E.nodes=function(e){return arguments.length?(L="function"==typeof e?e:s(e),E):L},E.links=function(e){return arguments.length?(S="function"==typeof e?e:s(e),E):S},E.linkSort=function(e){return arguments.length?(t=e,E):t},E.size=function(e){return arguments.length?(n=p=0,x=+e[0],v=+e[1],E):[x-n,v-p]},E.extent=function(e){return arguments.length?(n=+e[0][0],x=+e[1][0],p=+e[0][1],v=+e[1][1],E):[[n,p],[x,v]]},E.iterations=function(e){return arguments.length?(T=+e,E):T},E}},4127:function(e,t,n){"use strict";n.d(t,{Z:function(){return p}});var r=Math.PI,i=2*r,o=i-1e-6;function a(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function s(){return new a}a.prototype=s.prototype={constructor:a,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,o){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+o)},arcTo:function(e,t,n,i,o){e=+e,t=+t,n=+n,i=+i,o=+o;var a=this._x1,s=this._y1,l=n-e,c=i-t,d=a-e,h=s-t,u=d*d+h*h;if(o<0)throw Error("negative radius: "+o);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(u>1e-6){if(Math.abs(h*l-c*d)>1e-6&&o){var g=n-a,f=i-s,y=l*l+c*c,m=Math.sqrt(y),p=Math.sqrt(u),x=o*Math.tan((r-Math.acos((y+u-(g*g+f*f))/(2*m*p)))/2),v=x/p,j=x/m;Math.abs(v-1)>1e-6&&(this._+="L"+(e+v*d)+","+(t+v*h)),this._+="A"+o+","+o+",0,0,"+ +(h*g>d*f)+","+(this._x1=e+j*l)+","+(this._y1=t+j*c)}else this._+="L"+(this._x1=e)+","+(this._y1=t)}},arc:function(e,t,n,a,s,l){e=+e,t=+t,n=+n,l=!!l;var c=n*Math.cos(a),d=n*Math.sin(a),h=e+c,u=t+d,g=1^l,f=l?a-s:s-a;if(n<0)throw Error("negative radius: "+n);null===this._x1?this._+="M"+h+","+u:(Math.abs(this._x1-h)>1e-6||Math.abs(this._y1-u)>1e-6)&&(this._+="L"+h+","+u),n&&(f<0&&(f=f%i+i),f>o?this._+="A"+n+","+n+",0,1,"+g+","+(e-c)+","+(t-d)+"A"+n+","+n+",0,1,"+g+","+(this._x1=h)+","+(this._y1=u):f>1e-6&&(this._+="A"+n+","+n+",0,"+ +(f>=r)+","+g+","+(this._x1=e+n*Math.cos(s))+","+(this._y1=t+n*Math.sin(s))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var l=Array.prototype.slice;function c(e){return function(){return e}}function d(e){return e[0]}function h(e){return e[1]}function u(e){return e.source}function g(e){return e.target}function f(e,t,n,r,i){e.moveTo(t,n),e.bezierCurveTo(t=(t+r)/2,n,t,i,r,i)}function y(e){return[e.source.x1,e.y0]}function m(e){return[e.target.x0,e.y1]}function p(){return(function(e){var t=u,n=g,r=d,i=h,o=null;function a(){var a,c=l.call(arguments),d=t.apply(this,c),h=n.apply(this,c);if(o||(o=a=s()),e(o,+r.apply(this,(c[0]=d,c)),+i.apply(this,c),+r.apply(this,(c[0]=h,c)),+i.apply(this,c)),a)return o=null,a+""||null}return a.source=function(e){return arguments.length?(t=e,a):t},a.target=function(e){return arguments.length?(n=e,a):n},a.x=function(e){return arguments.length?(r="function"==typeof e?e:c(+e),a):r},a.y=function(e){return arguments.length?(i="function"==typeof e?e:c(+e),a):i},a.context=function(e){return arguments.length?(o=null==e?null:e,a):o},a})(f).source(y).target(m)}},81248:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sankey-diagram",function(){return n(68587)}])},90505:function(e,t,n){"use strict";n.d(t,{r:function(){return c}});var r=n(85893),i=n(41664),o=n.n(i),a=n(28843),s=n(66717),l=n(3572);let c=e=>{let{chartId:t}=e,n=a.c.filter(e=>e.id===t)[0].label;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{id:"responsiveness",children:"Responsive "+n+" with react"}),(0,r.jsxs)("p",{children:["The component above is not responsive. It expects 2 props called"," ",(0,r.jsx)("code",{children:"width"})," and ",(0,r.jsx)("code",{children:"height"})," and will render a ",n," of those dimensions."]}),(0,r.jsxs)("p",{children:["Making the ",n," responsive requires adding a ",(0,r.jsx)("b",{children:"wrapper"})," component that gets the dimension of the parent ",(0,r.jsx)("code",{children:"div"}),", and listening to a potential dimension change. This is possible thanks to a hook called"," ",(0,r.jsx)("code",{children:"useDimensions"})," that will do the job for us."]}),(0,r.jsx)(s.U,{title:(0,r.jsxs)("span",{children:[(0,r.jsx)("code",{children:"useDimensions"}),": a hook to make your viz responsive"]}),children:(0,r.jsx)(l.d,{code:d})}),(0,r.jsxs)("p",{children:["I'm in the process of writing a complete blog post on the topic."," ",(0,r.jsx)(o(),{href:"/subscribe",children:"Subscribe to the project"})," to know when it's ready."]}),(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)("br",{})]})},d='\nexport const useDimensions = (targetRef: React.RefObject<HTMLDivElement>) => {\n\n  const getDimensions = () => {\n    return {\n      width: targetRef.current ? targetRef.current.offsetWidth : 0,\n      height: targetRef.current ? targetRef.current.offsetHeight : 0\n    };\n  };\n\n  const [dimensions, setDimensions] = useState(getDimensions);\n\n  const handleResize = () => {\n    setDimensions(getDimensions());\n  };\n\n  useEffect(() => {\n    window.addEventListener("resize", handleResize);\n    return () => window.removeEventListener("resize", handleResize);\n  }, []);\n\n  useLayoutEffect(() => {\n    handleResize();\n  }, []);\n\n  return dimensions;\n}\n'.trim()},66717:function(e,t,n){"use strict";n.d(t,{U:function(){return i}});var r=n(85893);let i=e=>{let{title:t,children:n}=e;return(0,r.jsxs)("details",{className:"bg-gray-50 py-2 px-4 rounded-md my-2",children:[(0,r.jsx)("summary",{className:"cursor-pointer",children:t}),(0,r.jsx)("div",{className:"pt-4",children:n})]})}},18893:function(e,t,n){"use strict";n.d(t,{H:function(){return i}});var r=n(85893);let i=e=>{let{text:t}=e;return(0,r.jsxs)("blockquote",{className:"mt-10 opacity-20",children:[(0,r.jsx)("b",{className:"text-reactGallery mr-4",children:"ToDo"}),t]})}},68587:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var r=n(85893);n(67294);var i=n(80153),o=n(43710),a=n(61651),s=n(3572),l=n(81122),c=n(26820),d=n(90505),h=n(18893);let u={nodes:[{id:"bob"},{id:"alice"},{id:"carol"},{id:"mel"},{id:"yan"}],links:[{source:"bob",target:"carol",value:4},{source:"alice",target:"carol",value:3},{source:"alice",target:"yan",value:1},{source:"carol",target:"mel",value:6},{source:"carol",target:"yan",value:1}]};var g=n(94091),f=n(57929),y=n(4127);let m=e=>{let{width:t,height:n,data:i}=e,o=(0,g.Z)().nodeWidth(26).nodePadding(29).extent([[5,25],[t-5,n-25]]).nodeId(e=>e.id).nodeAlign(f.be),{nodes:a,links:s}=o(i),l=a.map(e=>(0,r.jsx)("g",{children:(0,r.jsx)("rect",{height:e.y1-e.y0,width:o.nodeWidth(),x:e.x0,y:e.y0,stroke:"black",fill:"#a53253",fillOpacity:.8,rx:.9})},e.index)),c=s.map((e,t)=>{let n=(0,y.Z)(),i=n(e);return(0,r.jsx)("path",{d:i,stroke:"#a53253",fill:"none",strokeOpacity:.1,strokeWidth:e.width},t)});return(0,r.jsx)("div",{children:(0,r.jsxs)("svg",{width:t,height:n,children:[l,c]})})},p=e=>{let{width:t=700,height:n=400}=e;return 0===t?null:(0,r.jsx)(m,{data:u,width:t,height:n})},x={nodes:[{id:"bob"},{id:"alice"},{id:"carol"},{id:"mel"},{id:"yan"}],links:[{source:"bob",target:"carol",value:4},{source:"alice",target:"carol",value:3},{source:"alice",target:"yan",value:1},{source:"carol",target:"mel",value:6},{source:"carol",target:"yan",value:1}]},v=e=>{let{width:t,height:n,data:i}=e,o=(0,g.Z)().nodeWidth(26).nodePadding(29).extent([[5,25],[t-5,n-25]]).nodeId(e=>e.id).nodeAlign(f.be),{nodes:a,links:s}=o(i),l=a.map(e=>(0,r.jsx)("g",{children:(0,r.jsx)("rect",{height:e.y1-e.y0,width:o.nodeWidth(),x:e.x0,y:e.y0,stroke:"black",fill:"#a53253",fillOpacity:.8,rx:.9})},e.index));return(0,r.jsx)("div",{children:(0,r.jsx)("svg",{width:t,height:n,children:l})})},j=e=>{let{width:t=700,height:n=400}=e;return 0===t?null:(0,r.jsx)(v,{data:x,width:t,height:n})},k={nodes:[{name:"Agricultural 'waste'",category:"Agricultural"},{name:"Bio-conversion",category:"Bio-conversion"},{name:"Liquid",category:"Liquid"},{name:"Losses",category:"Losses"},{name:"Solid",category:"Solid"},{name:"Gas",category:"Gas"},{name:"Biofuel imports",category:"Biofuel"},{name:"Biomass imports",category:"Biomass"},{name:"Coal imports",category:"Coal"},{name:"Coal",category:"Coal"},{name:"Coal reserves",category:"Coal"},{name:"District heating",category:"District"},{name:"Industry",category:"Industry"},{name:"Heating and cooling - commercial",category:"Heating"},{name:"Heating and cooling - homes",category:"Heating"},{name:"Electricity grid",category:"Electricity"},{name:"Over generation / exports",category:"Over"},{name:"H2 conversion",category:"H2"},{name:"Road transport",category:"Road"},{name:"Agriculture",category:"Agriculture"},{name:"Rail transport",category:"Rail"},{name:"Lighting & appliances - commercial",category:"Lighting"},{name:"Lighting & appliances - homes",category:"Lighting"},{name:"Gas imports",category:"Gas"},{name:"Ngas",category:"Ngas"},{name:"Gas reserves",category:"Gas"},{name:"Thermal generation",category:"Thermal"},{name:"Geothermal",category:"Geothermal"},{name:"H2",category:"H2"},{name:"Hydro",category:"Hydro"},{name:"International shipping",category:"International"},{name:"Domestic aviation",category:"Domestic"},{name:"International aviation",category:"International"},{name:"National navigation",category:"National"},{name:"Marine algae",category:"Marine"},{name:"Nuclear",category:"Nuclear"},{name:"Oil imports",category:"Oil"},{name:"Oil",category:"Oil"},{name:"Oil reserves",category:"Oil"},{name:"Other waste",category:"Other"},{name:"Pumped heat",category:"Pumped"},{name:"Solar PV",category:"Solar"},{name:"Solar Thermal",category:"Solar"},{name:"Solar",category:"Solar"},{name:"Tidal",category:"Tidal"},{name:"UK land based bioenergy",category:"UK"},{name:"Wave",category:"Wave"},{name:"Wind",category:"Wind"}],links:[{source:"Agricultural 'waste'",target:"Bio-conversion",value:124.729},{source:"Bio-conversion",target:"Liquid",value:.597},{source:"Bio-conversion",target:"Losses",value:26.862},{source:"Bio-conversion",target:"Solid",value:280.322},{source:"Bio-conversion",target:"Gas",value:81.144},{source:"Biofuel imports",target:"Liquid",value:35},{source:"Biomass imports",target:"Solid",value:35},{source:"Coal imports",target:"Coal",value:11.606},{source:"Coal reserves",target:"Coal",value:63.965},{source:"Coal",target:"Solid",value:75.571},{source:"District heating",target:"Industry",value:10.639},{source:"District heating",target:"Heating and cooling - commercial",value:22.505},{source:"District heating",target:"Heating and cooling - homes",value:46.184},{source:"Electricity grid",target:"Over generation / exports",value:104.453},{source:"Electricity grid",target:"Heating and cooling - homes",value:113.726},{source:"Electricity grid",target:"H2 conversion",value:27.14},{source:"Electricity grid",target:"Industry",value:342.165},{source:"Electricity grid",target:"Road transport",value:37.797},{source:"Electricity grid",target:"Agriculture",value:4.412},{source:"Electricity grid",target:"Heating and cooling - commercial",value:40.858},{source:"Electricity grid",target:"Losses",value:56.691},{source:"Electricity grid",target:"Rail transport",value:7.863},{source:"Electricity grid",target:"Lighting & appliances - commercial",value:90.008},{source:"Electricity grid",target:"Lighting & appliances - homes",value:93.494},{source:"Gas imports",target:"Ngas",value:40.719},{source:"Gas reserves",target:"Ngas",value:82.233},{source:"Gas",target:"Heating and cooling - commercial",value:.129},{source:"Gas",target:"Losses",value:1.401},{source:"Gas",target:"Thermal generation",value:151.891},{source:"Gas",target:"Agriculture",value:2.096},{source:"Gas",target:"Industry",value:48.58},{source:"Geothermal",target:"Electricity grid",value:7.013},{source:"H2 conversion",target:"H2",value:20.897},{source:"H2 conversion",target:"Losses",value:6.242},{source:"H2",target:"Road transport",value:20.897},{source:"Hydro",target:"Electricity grid",value:6.995},{source:"Liquid",target:"Industry",value:121.066},{source:"Liquid",target:"International shipping",value:128.69},{source:"Liquid",target:"Road transport",value:135.835},{source:"Liquid",target:"Domestic aviation",value:14.458},{source:"Liquid",target:"International aviation",value:206.267},{source:"Liquid",target:"Agriculture",value:3.64},{source:"Liquid",target:"National navigation",value:33.218},{source:"Liquid",target:"Rail transport",value:4.413},{source:"Marine algae",target:"Bio-conversion",value:4.375},{source:"Ngas",target:"Gas",value:122.952},{source:"Nuclear",target:"Thermal generation",value:839.978},{source:"Oil imports",target:"Oil",value:504.287},{source:"Oil reserves",target:"Oil",value:107.703},{source:"Oil",target:"Liquid",value:611.99},{source:"Other waste",target:"Solid",value:56.587},{source:"Other waste",target:"Bio-conversion",value:77.81},{source:"Pumped heat",target:"Heating and cooling - homes",value:193.026},{source:"Pumped heat",target:"Heating and cooling - commercial",value:70.672},{source:"Solar PV",target:"Electricity grid",value:59.901},{source:"Solar Thermal",target:"Heating and cooling - homes",value:19.263},{source:"Solar",target:"Solar Thermal",value:19.263},{source:"Solar",target:"Solar PV",value:59.901},{source:"Solid",target:"Agriculture",value:.882},{source:"Solid",target:"Thermal generation",value:400.12},{source:"Solid",target:"Industry",value:46.477},{source:"Thermal generation",target:"Electricity grid",value:525.531},{source:"Thermal generation",target:"Losses",value:787.129},{source:"Thermal generation",target:"District heating",value:79.329},{source:"Tidal",target:"Electricity grid",value:9.452},{source:"UK land based bioenergy",target:"Bio-conversion",value:182.01},{source:"Wave",target:"Electricity grid",value:19.013},{source:"Wind",target:"Electricity grid",value:289.366}]};var w=n(78995);let b=["#e0ac2b","#e85252","#6689c6","#9a6fb0","#a53253"],_=e=>{let{width:t,height:n,data:i}=e,o=[...new Set(i.nodes.map(e=>e.category))].sort(),a=(0,w.PKp)().domain(o).range(b),s=(0,g.Z)().nodeWidth(26).nodePadding(10).extent([[5,25],[t-5,n-25]]).nodeId(e=>e.name).nodeAlign(f.PT),{nodes:l,links:c}=s(i),d=l.map(e=>(0,r.jsx)("g",{children:(0,r.jsx)("rect",{height:e.y1-e.y0,width:s.nodeWidth(),x:e.x0,y:e.y0,stroke:"black",fill:a(e.category),fillOpacity:1,rx:.9})},e.index)),h=c.map((e,t)=>{let n=(0,y.Z)(),i=n(e);return(0,r.jsx)("path",{d:i,stroke:a(e.source.category),fill:"none",strokeOpacity:.3,strokeWidth:e.width},t)}),u=l.map((e,n)=>(0,r.jsx)("text",{x:e.x0<t/2?e.x1+6:e.x0-6,y:(e.y1+e.y0)/2,dy:"0.35rem",textAnchor:e.x0<t/2?"start":"end",fontSize:12,children:e.name},n));return(0,r.jsx)("div",{children:(0,r.jsxs)("svg",{width:t,height:n,children:[h,d,u]})})},L=e=>{let{width:t=700,height:n=400}=e;return 0===t?null:(0,r.jsx)(_,{data:k,width:t,height:n})},S=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:["A"," ",(0,r.jsx)("a",{href:"https://www.data-to-viz.com/graph/sankey.html",children:"Sankey Diagram"})," ","display ",(0,r.jsx)("b",{children:"flows"}),". Several entities (",(0,r.jsx)("b",{children:"nodes"}),") are represented by rectangles or text. Directed ",(0,r.jsx)("b",{children:"links"})," are represented with arrows or arcs that have a width proportional to the importance of the flow."]}),(0,r.jsxs)("p",{children:["This tutorial explains how to use ",(0,r.jsx)("code",{children:"React"}),", ",(0,r.jsx)("code",{children:"D3.js"})," ","and the ",(0,r.jsx)("code",{children:"d3-sankey"})," plugin to build a Sankey diagram. It comes with explanations and code sandboxes to play along with the suggested implementation."]})]});function T(){return(0,r.jsxs)(i.A,{title:"How to build a Sankey Diagram with React and D3.",seoDescription:"A step-by-step guide to build your very own Sankey Diagram from scratch. Comes with explanations, code sandboxes, and ready-to-use templates.",children:[(0,r.jsx)(o.Z,{title:"Sankey Diagram",description:S,chartType:"sankey"}),(0,r.jsx)("h2",{id:"data",children:"The Data"}),(0,r.jsxs)("p",{children:["Two layers of information are required to build a Sankey diagram: a list of ",(0,r.jsx)("b",{children:"nodes"})," to build the rectangles and a list of ",(0,r.jsx)("b",{children:"links"})," to build the paths between them."]}),(0,r.jsx)("p",{children:"Many different data structures can be used to store such information. In this tutorial I suggest to start with the following:"}),(0,r.jsx)(s.d,{code:E}),(0,r.jsxs)("p",{children:[(0,r.jsx)("code",{children:"data"})," is an object with 2 properties: ",(0,r.jsx)("code",{children:"nodes"})," and"," ",(0,r.jsx)("code",{children:"links"}),"."]}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"nodes"})," is an array where each node is an object defined by its index (",(0,r.jsx)("code",{children:"node"}),") and its ",(0,r.jsx)("code",{children:"name"}),". Note that any other feature can be added to nodes here."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"links"})," is another array listing the connections. They are defined by a ",(0,r.jsx)("code",{children:"source"})," and a ",(0,r.jsx)("code",{children:"target"})," and optionnaly with a ",(0,r.jsx)("code",{children:"value"}),"."]})]}),(0,r.jsx)(h.H,{text:"Explain how to build this data structure from various initial formats"}),(0,r.jsx)("h2",{id:"skeleton",children:"Component skeleton"}),(0,r.jsxs)("p",{children:["The goal here is to create a ",(0,r.jsx)("code",{children:"Sankey"})," component that will be stored in a ",(0,r.jsx)("code",{children:"Sankey.tsx"})," file. This component requires 3 props to render: a ",(0,r.jsx)("code",{children:"width"}),", a ",(0,r.jsx)("code",{children:"height"}),", and some"," ",(0,r.jsx)("code",{children:"data"}),"."]}),(0,r.jsxs)("p",{children:["The shape of the ",(0,r.jsx)("code",{children:"data"})," is described above. The"," ",(0,r.jsx)("code",{children:"width"})," and ",(0,r.jsx)("code",{children:"height"})," will be used to render an"," ",(0,r.jsx)("code",{children:"svg"})," element in the DOM, in which we will insert the Sankey."]}),(0,r.jsxs)("p",{children:["To put it in a nutshell, that's the skeleton of our ",(0,r.jsx)("code",{children:"Sankey"})," ","component:"]}),(0,r.jsx)(s.d,{code:M}),(0,r.jsxs)("p",{children:["It's fundamental to understand that with this code organization, d3.js will be used to layout (",(0,r.jsx)("code",{children:"rect"})," and ",(0,r.jsx)("code",{children:"path"})," ","positions), but it's React that will render them in the"," ",(0,r.jsx)("code",{children:"return()"})," statement. We won't use d3 methods like"," ",(0,r.jsx)("code",{children:"append"})," that you can find in usual"," ",(0,r.jsx)("a",{href:"https://www.d3-graph-gallery.com",children:"d3.js examples"}),"."]}),(0,r.jsx)("h2",{id:"Nodes",children:"Draw the nodes"}),(0,r.jsxs)("p",{children:["To draw the nodes we first need to compute their positions on the SVG area. This is where the"," ",(0,r.jsx)("a",{href:"https://github.com/d3/d3-sankey",children:"d3-sankey plugin"})," gets helpful with its ",(0,r.jsx)("code",{children:"sankey()"}),"function."]}),(0,r.jsxs)("p",{children:["The ",(0,r.jsx)("code",{children:"sankey()"})," function must be called with a set of options described below as inline comments:"]}),(0,r.jsx)(s.d,{code:A}),(0,r.jsxs)("p",{children:["We now have a function called ",(0,r.jsx)("code",{children:"sankeyGenerator"})," that computes the sankey layout from our dataset. We can use it as follow:"]}),(0,r.jsx)(s.d,{code:D}),(0,r.jsxs)("p",{children:["And that's it. We now have 2 objects called ",(0,r.jsx)("code",{children:"nodes"})," and"," ",(0,r.jsx)("code",{children:"links"})," that provide all the necessary information about nodes and links. ",(0,r.jsx)("code",{children:"nodes"})," is an array. For each item we have",(0,r.jsx)("code",{children:"x0"}),", ",(0,r.jsx)("code",{children:"y0"}),", ",(0,r.jsx)("code",{children:"x1"})," and ",(0,r.jsx)("code",{children:"y1"})," ","that are the coordinates of the top-left and bottom right corners of the rectangle. We are ready for the drawing! ✏️"]}),(0,r.jsx)(l.$,{VizComponent:j,vizName:"SankeyDiagramNodeOnly",maxWidth:500,height:300,caption:"First step of our ongoing sankey diagram: the nodes are displayed using rectangles."}),(0,r.jsx)("h2",{id:"connections",children:"Draw the connections"}),(0,r.jsxs)("p",{children:["The other object we got from the ",(0,r.jsx)("code",{children:"sankey()"})," function is"," ",(0,r.jsx)("code",{children:"links"}),". It is an array where each item provides detail about a link."]}),(0,r.jsx)("p",{children:"Each item is an object with several properties. Among them:"}),(0,r.jsxs)("ul",{children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"width"})," → provides the width of the arc we will build. We will pass it to the ",(0,r.jsx)("code",{children:"strokeWidth"})," property of the SVG"," ",(0,r.jsx)("code",{children:"path"}),"."]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("code",{children:"source"})," and ",(0,r.jsx)("code",{children:"target"})," → provide a lot of details about the source and target nodes, including their positions. It makes it possible to pass a link to the"," ",(0,r.jsx)("code",{children:"sankeyLinkHorizontal()"})," function to get the SVG path we will give as the ",(0,r.jsx)("code",{children:"d"})," argument."]})]}),(0,r.jsxs)("p",{children:["To put it in a nutshell, we can loop through the ",(0,r.jsx)("code",{children:"links"})," ","array and draw a",(0,r.jsx)("code",{children:"path"})," as follow:"]}),(0,r.jsx)(s.d,{code:H}),(0,r.jsx)("p",{children:"Resulting in a first Sankey diagram \uD83C\uDF89"}),(0,r.jsx)(l.$,{VizComponent:p,vizName:"SankeyDiagramBasic",maxWidth:500,height:300,caption:"First step of our ongoing arc diagram: the nodes are displayed at the bottom of the figure."}),(0,r.jsx)(d.r,{chartId:"sankey"}),(0,r.jsx)(c.Z,{chartId:"sankey"}),(0,r.jsx)("h2",{id:"application",children:"Application to a real dataset"}),(0,r.jsxs)("p",{children:["This Sankey diagram visualizes the flow of energy: supplies are on the left, and demands are on the right. It is a reproduction of this famous observable"," ",(0,r.jsx)("a",{href:"https://observablehq.com/@d3/sankey/2?intent=fork",children:"example"}),". Links show how varying amounts of energy are converted or transmitted before being consumed or lost."]}),(0,r.jsxs)("p",{children:["The code is very similar to the example above. On top of it, a"," ",(0,r.jsx)("b",{children:"color scale"})," is used for the node and connection colors, and some text ",(0,r.jsx)("b",{children:"labels"})," have been added."]}),(0,r.jsx)(l.$,{VizComponent:L,vizName:"SankeyDiagramEnergyFlow",maxWidth:1e3,height:800,caption:"A Sankey diagram showing the flow of energy. Supplies on the left, demands on the right."}),(0,r.jsx)(h.H,{text:"Add hover effect to highlight links"}),(0,r.jsx)(h.H,{text:"Add gradient along links"}),(0,r.jsx)(h.H,{text:"Fix types"}),(0,r.jsx)("div",{className:"full-bleed border-t h-0 bg-gray-100 mb-3 mt-24"}),(0,r.jsx)(a.Z,{chartFamily:"flow"}),(0,r.jsx)("div",{className:"mt-20"})]})}let E='\nconst data = {\n  nodes: [\n      { node: 0, name: "node0" },\n      { node: 1, name: "node1" },\n      { node: 2, name: "node2" },\n      { node: 3, name: "node3" },\n  ],\n  links: [\n      { source: 0, target: 2, value: 2 },\n      { source: 1, target: 2, value: 2 },\n      { source: 1, target: 3, value: 2 },\n  ]\n}\n\n'.trim(),M='\nimport * as d3 from "d3"; // we will need d3.js\n\ntype SankeyProps = {\n  width: number;\n  height: number;\n  data: number[];\n};\n\nexport const Sankey = ({ width, height, data }: SankeyProps) => {\n\n  // read the data\n  // create a color scale for the nodes\n  // compute node position thanks to the d3.sankey() function\n  // build the rectangles and arcs\n\n  return (\n    <div>\n      <svg width={width} height={height}>\n        // render all the <rect> and <path>\n      </svg>\n    </div>\n  );\n};\n'.trim(),A="\nconst sankeyGenerator = sankey()  // Main function of the d3-sankey plugin that computes the layout\n    .nodeWidth(26)                  // width of the node in pixels\n    .nodePadding(29)                // space between nodes\n    .extent([                       // chart area:\n      [MARGIN_X, MARGIN_Y],                   // top-left coordinates\n      [width - MARGIN_X, height - MARGIN_Y],  // botton-right coordinates\n    ])\n    .nodeId((node) => node.id)      // Accessor function: how to retrieve the id that defines each node. This id is then used for the source and target props of links\n    .nodeAlign(sankeyCenter);       // Algorithm used to decide node position\n".trim(),D="\nconst { nodes, links } = sankeyGenerator(data);\n".trim(),H='\nconst allLinks = links.map((link, i) => {\n  const linkGenerator = sankeyLinkHorizontal();\n  const path = linkGenerator(link);\n\n  return (\n    <path\n      key={i}\n      d={path}\n      stroke="#a53253"\n      fill="none"\n      strokeOpacity={0.1}\n      strokeWidth={link.width}\n    />\n  );\n});\n'.trim()}},function(e){e.O(0,[2343,7754,8995,7823,8190,3710,2594,6588,9774,2888,179],function(){return e(e.s=81248)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[746],{75430:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/cross-graph-highlight-interaction",function(){return r(56398)}])},61651:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(85893);r(67294);var i=r(49871),s=r(28843),o=r(77522);let l={distribution:"Distribution",correlation:"Correlation",ranking:"Ranking",partOfAWhole:"Part Of A Whole",evolution:"Evolution",map:"Map",flow:"Flow",general:"General Knowledge"};function a(e){let{chartFamily:t}=e,r=s.c.filter(e=>e.family===t).map((e,t)=>{let r=(0,o.y)(e.reactURL);return(0,n.jsx)("div",{className:"flex flex-col items-center justify-center",children:(0,n.jsx)(i.Z,{link:r,chartLogo:e.logo,caption:e.label,isAvailable:e.isAvailable,size:122})},t)});return(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:t+"  mt-4 text-md border-b mb-2 border-gray-100 tracking-wider",children:null==l?void 0:l[t]}),(0,n.jsx)("div",{className:"flex flex-row justify-start flex-wrap",children:r})]})}},81122:function(e,t,r){"use strict";r.d(t,{$:function(){return c}});var n=r(85893),i=r(67294),s=r(59973),o=r(80615),l=r(88578),a=r(5);let c=e=>{let{VizComponent:t,vizName:r,height:c=400,maxWidth:h=800,caption:d,fileToOpen:u}=e,[p,x]=(0,i.useState)(!1),f=(0,i.useRef)(null),g=(0,s.B)(f);return(0,n.jsx)("div",{style:{marginLeft:"-50vw",left:"50%"},className:"my-4 py-4 w-screen relative",children:p?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center w-full",children:[(0,n.jsx)("div",{style:{maxWidth:2e3},className:"w-full z-50",children:(0,n.jsx)(l.X,{vizName:r,fileToOpen:u})}),(0,n.jsx)("div",{className:"flex justify-center mt-2",children:(0,n.jsx)(a.z,{size:"sm",onClick:()=>x(!p),children:"Hide Sandbox"})})]}):(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,n.jsx)("div",{className:"bg-gray-100 bg-opacity-50 w-screen flex justify-center z-50 pointer-events-none",children:(0,n.jsx)("div",{style:{height:c,width:"100%",maxWidth:h},ref:f,className:"pointer-events-auto",children:(0,n.jsx)(t,{height:c,width:g.width})})}),(0,n.jsx)(o.Y,{children:d}),(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)(a.z,{size:"sm",onClick:()=>x(!p),children:"Show code"})})]})})}},88578:function(e,t,r){"use strict";r.d(t,{X:function(){return i}});var n=r(85893);r(67294);let i=e=>{let{vizName:t,height:r="500px",fileToOpen:i}=e;return console.log("rerendeeeerrrrr"),(0,n.jsx)("iframe",{src:"https://codesandbox.io/embed/github/holtzy/react-graph-gallery/tree/main/viz/"+t+"?fontsize=14&hidenavigation=1&theme=dark&expanddevtools=0&view=split"+(i?"&module=/".concat(i):""),style:{width:"100%",height:r,border:"solid",borderWidth:2,borderRadius:"4px",overflow:"hidden"},allow:"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking",sandbox:"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"})}},80153:function(e,t,r){"use strict";r.d(t,{A:function(){return u}});var n=r(85893),i=r(49700),s=r(63476),o=r(67294),l=r(63084),a=r.n(l);function c(){let[e,t]=(0,o.useState)([]),[r,i]=(0,o.useState)(0);return(0,o.useEffect)(()=>{let e=Array.from(document.querySelectorAll("h2"));t(e)},[]),(0,o.useEffect)(()=>{let t=()=>{let t=e.map(e=>e.offsetTop-e.scrollTop+e.clientTop),r=window.scrollY+150,n=t.reduce((e,t)=>Math.abs(t-r)<Math.abs(e-r)?t:e,0),s=t.findIndex(e=>e===n);i(-1===s?0:s)};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[e]),(0,n.jsx)("div",{className:a().tableOfContent,children:e.map((t,i)=>(0,n.jsx)("p",{className:r===i?"".concat(a().tocItem," ").concat(a().tocItemActive):a().tocItem,onClick:t=>{t.preventDefault(),e[i].scrollIntoView({behavior:"smooth",block:"start",alignToTop:!0})},children:t.id.charAt(0).toUpperCase()+t.id.slice(1)},t.id))})}var h=r(17414),d=r(62594);let u=e=>{let{children:t,title:r,seoDescription:o}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.A,{title:r,seoDescription:o}),(0,n.jsx)(i.Z,{}),(0,n.jsx)("div",{className:"wrapper",children:t}),(0,n.jsx)(d.Z,{}),(0,n.jsx)("div",{className:"wrapper",children:(0,n.jsx)(s.Z,{})}),(0,n.jsx)(c,{})]})}},49871:function(e,t,r){"use strict";r.d(t,{Z:function(){return c}});var n=r(85893);r(67294);var i=r(95887),s=r(28843),o=r(41664),l=r.n(o);let a=s.c.filter(e=>"general"===e.family).map(e=>e.logo);function c(e){let{chartLogo:t,caption:r,link:s,isAvailable:o,size:c}=e,d=a.includes(t),u=o?"opacity-100":"opacity-20";return(0,n.jsx)(l(),{href:o?s:"subscribe",className:"no-underline",children:(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsxs)("div",{style:{width:c,height:c},className:"relative mr-2 rounded-full "+u+" "+(o?"cursor-pointer":"cursor-not-allowed"),children:[(0,n.jsx)("div",{className:"absolute",children:(0,n.jsx)(i.Z,{chartLogo:t,size:c})}),d?(0,n.jsx)("div",{className:"absolute opacity-0 hover:opacity-60 flex items-center justify-center w-full h-full z-30",children:(0,n.jsx)(h,{size:c})}):(0,n.jsx)("div",{style:{backgroundColor:"var(--react-gallery)"},className:"opacity-0 hover:opacity-60 flex items-center justify-center w-full h-full rounded-full  z-30",children:(0,n.jsx)("span",{className:"text-white text-4xl",children:"+"})})]}),(0,n.jsx)("p",{className:"font-light text-sm text-gray-600 "+u,children:r})]})})}let h=e=>{let{size:t}=e;return(0,n.jsx)("svg",{version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 100 100",className:"fill-current text-purple-800",children:(0,n.jsx)("path",{d:"M50,0 L100,20 L100,80 L50,100 L0,80 L0,20 Z"})})}},80615:function(e,t,r){"use strict";r.d(t,{Y:function(){return i}});var n=r(85893);let i=e=>{let{children:t}=e;return(0,n.jsx)("p",{className:"text-sm text-gray-500 max-w-xs italic text-center mt-4 font-light",children:t})}},3572:function(e,t,r){"use strict";r.d(t,{d:function(){return h}});var n=r(85893),i=r(32581),s=r(15660),o=r.n(s),l=r(67294),a=r(45993),c=r.n(a);let h=e=>{let{code:t}=e,[r,s]=(0,l.useState)(!1),a=(0,l.useRef)(null);(0,l.useEffect)(()=>{a.current&&o().highlightElement(a.current)},[a,t]);let h=(0,n.jsx)("div",{onClick:()=>{navigator.clipboard.writeText(t),s(!0)},className:c().codeChunckCopyButton,children:r?"Copied":(0,n.jsx)(i.Z,{size:14,style:{padding:0}})});return(0,n.jsxs)("div",{className:"mb-6 relative",children:[(0,n.jsx)("pre",{className:"rounded-md line-numbers",children:(0,n.jsx)("code",{ref:a,className:"language-javascript",children:t})}),(0,n.jsx)("div",{className:c().copyButtonContainer,children:h})]})}},59973:function(e,t,r){"use strict";r.d(t,{B:function(){return i}});var n=r(67294);let i=e=>{let t=()=>({width:e.current?e.current.offsetWidth:0,height:e.current?e.current.offsetHeight:0}),[r,i]=(0,n.useState)(t),s=()=>{i(t())};return(0,n.useEffect)(()=>(window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)),[]),(0,n.useEffect)(()=>{s()},[e]),r}},56398:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return I}});var n=r(85893),i=r(67294),s=r(80153),o=r(43710),l=r(62594),a=r(61651),c=r(3572),h=r(78995);let d=e=>{let{width:t,height:r,group:s,setGroup:o,color:l}=e,a=(0,i.useMemo)(()=>{let e=[];for(;e.length<1500;){let t=Math.floor(100*Math.random())+1;e.push(t)}return e},[]),c=(0,i.useMemo)(()=>h.BYU().domain([0,100]).range([0,t]),[t]),d=a.map((e,r)=>(0,n.jsxs)("div",{onMouseEnter:()=>o(r),onMouseLeave:()=>o(null),style:{width:t,height:15,position:"relative",margin:1},children:[(0,n.jsx)("div",{style:{position:"absolute",height:"100%",width:c(e),backgroundColor:l,opacity:s===r?1:.4,borderRadius:2}}),(0,n.jsx)("div",{style:{position:"absolute",height:"100%",fontSize:8,marginLeft:4,marginTop:2,color:"grey"},children:(0,n.jsx)("p",{children:r})})]},r));return(0,n.jsx)("div",{style:{width:t,height:r,overflow:"scroll"},children:d})},u=e=>{let{width:t,height:r}=e,[s,o]=(0,i.useState)(null);return t&&r?(0,n.jsxs)("div",{style:{display:"flex",width:t,height:r,flexWrap:"wrap",justifyContent:"center"},children:[(0,n.jsx)(d,{width:300,height:220,group:s,setGroup:o,color:"#e85252"}),(0,n.jsx)(d,{width:300,height:220,group:s,setGroup:o,color:"#6689c6"}),(0,n.jsx)(d,{width:300,height:220,group:s,setGroup:o,color:"#9a6fb0"}),(0,n.jsx)(d,{width:300,height:220,group:s,setGroup:o,color:"#a53253"})]}):null},p=e=>{let{width:t=700,height:r=400}=e;return(0,n.jsx)(u,{width:t,height:r})};var x=r(81122),f=r(18446),g=r.n(f);let m=(0,i.createContext)(null);class j{addListener(e){let t=t=>{e(t.detail)};return this.eventTarget.addEventListener("groupchange",t),()=>{this.eventTarget.removeEventListener("groupchange",t)}}emit(e){this.eventTarget.dispatchEvent(new CustomEvent("groupchange",{detail:e}))}constructor(){this.eventTarget=new EventTarget}}let v=e=>{let{children:t}=e,r=(0,i.useRef)(new j);return(0,n.jsx)(m.Provider,{value:r.current,children:t})},w=e=>{let t=(0,i.useContext)(m),r=(0,i.useRef)(e);(0,i.useLayoutEffect)(()=>{r.current=e});let n=(0,i.useRef)(null),s=(0,i.useCallback)(e=>{let t=n.current;g()(e,t)||r.current(e),n.current=e},[]);(0,i.useEffect)(()=>null==t?void 0:t.addListener(e=>{s(e)}),[s,t]);let o=(0,i.useCallback)(e=>null==t?void 0:t.emit(e),[t]);return o};var y=r(2141),b=r.n(y);let _=e=>{let{width:t,height:r,color:s}=e,o=(0,i.useRef)(null),l=(0,i.useMemo)(()=>{let e=[];for(;e.length<1500;){let t=Math.floor(100*Math.random())+1;e.push(t)}return e},[]),a=(0,i.useMemo)(()=>h.BYU().domain([0,100]).range([0,t]),[t]),c=e=>{if(!o.current)return;let t=o.current.querySelectorAll(".".concat(b().highlighted));for(let e of Array.from(t))e.classList.remove("".concat(b().highlighted));if(!e)return;let r=o.current.querySelectorAll(".group_"+e);for(let e of Array.from(r))e.classList.add("".concat(b().highlighted))},d=w(e=>c(e)),u=l.map((e,r)=>(0,n.jsxs)("div",{onMouseEnter:()=>d(String(r)),onMouseLeave:()=>d(null),className:b().barContainer+" group_"+String(r),style:{width:t},children:[(0,n.jsx)("div",{className:b().bar,style:{width:a(e),backgroundColor:s}}),(0,n.jsx)("div",{className:b().text,children:(0,n.jsx)("p",{children:r})})]},r));return(0,n.jsx)("div",{ref:o,style:{width:t,height:r,overflow:"scroll"},children:u})},C=e=>{let{width:t,height:r}=e;return t&&r?(0,n.jsx)("div",{style:{display:"flex",width:t,height:r,flexWrap:"wrap",justifyContent:"center"},children:(0,n.jsxs)(v,{children:[(0,n.jsx)(_,{width:300,height:220,color:"#e85252"}),(0,n.jsx)(_,{width:300,height:220,color:"#6689c6"}),(0,n.jsx)(_,{width:300,height:220,color:"#9a6fb0"}),(0,n.jsx)(_,{width:300,height:220,color:"#a53253"})]})}):null},N=e=>{let{width:t=700,height:r=400}=e;return(0,n.jsx)(C,{width:t,height:r})};var E=r(92981),k=r.n(E);let z=e=>{let{width:t,height:r,group:s,setGroup:o,color:l}=e,a=(0,i.useRef)(null),c=(0,i.useMemo)(()=>{let e=[];for(;e.length<1500;){let t=Math.floor(100*Math.random())+1;e.push(t)}return e},[]),d=(0,i.useMemo)(()=>h.BYU().domain([0,100]).range([0,t]),[t]),u=e=>{if(!a.current)return;let t=a.current.querySelectorAll(".".concat(k().highlighted));for(let e of Array.from(t))e.classList.remove("".concat(k().highlighted));if(!e)return;let r=a.current.querySelectorAll(".group_"+e);for(let e of Array.from(r))e.classList.add("".concat(k().highlighted))};(0,i.useEffect)(()=>{u(String(s))},[s]);let p=(0,i.useMemo)(()=>c.map((e,r)=>(0,n.jsxs)("div",{onMouseEnter:()=>o(r),onMouseLeave:()=>o(null),className:k().barContainer+" group_"+String(r),style:{width:t},children:[(0,n.jsx)("div",{className:k().bar,style:{width:d(e),backgroundColor:l}}),(0,n.jsx)("div",{className:k().text,children:(0,n.jsx)("p",{children:r})})]},r)),[c,t,r,l]);return(0,n.jsx)("div",{ref:a,style:{width:t,height:r,overflow:"scroll"},children:p})},A=e=>{let{width:t,height:r}=e,[s,o]=(0,i.useState)(null);return t&&r?(0,n.jsxs)("div",{style:{display:"flex",width:t,height:r,flexWrap:"wrap",justifyContent:"center"},children:[(0,n.jsx)(z,{width:300,height:220,group:s,setGroup:o,color:"#e85252"}),(0,n.jsx)(z,{width:300,height:220,group:s,setGroup:o,color:"#6689c6"}),(0,n.jsx)(z,{width:300,height:220,group:s,setGroup:o,color:"#9a6fb0"}),(0,n.jsx)(z,{width:300,height:220,group:s,setGroup:o,color:"#a53253"})]}):null},L=e=>{let{width:t=700,height:r=400}=e;return(0,n.jsx)(A,{width:t,height:r})},S=(0,n.jsx)("p",{children:"This post explains how to add cross graph interactions in a react app. It focus on performance, showing how a naive approach with a shared state leads to a disappointing result and how a react context can solve the problem."}),B="\nconst [group, setGroup] = useState<number | null>(null);\n".trim(),M="\n<Barplot\n  width={300}\n  height={220}\n  group={group}\n  setGroup={setGroup}\n/>\n".trim(),T="\nstyle={{\n  opacity: group === i ? 1 : 0.4,\n}}\n".trim();function I(){return(0,n.jsxs)(s.A,{title:"Cross graph highlight interaction",seoDescription:"This blogpost explains how to add a highlight interaction between different vizs of a website. It relies on react and d3.js for rendering, and uses a context for performance.",children:[(0,n.jsx)(o.Z,{title:"Cross graph highlight interaction",description:S}),(0,n.jsxs)("blockquote",{children:["Disclaimer: the concepts explained here where showed to me by my colleague ",(0,n.jsx)("a",{href:"https://github.com/gvergnaud",children:"Gabriel Vergnaud"}),"."]}),(0,n.jsx)("h2",{id:"definition",children:"What is cross graph interaction"}),(0,n.jsx)("p",{children:"What it is."}),(0,n.jsx)("p",{children:"working example"}),(0,n.jsx)("p",{children:"Why do we care?"}),(0,n.jsx)("p",{children:"Focus on performance"}),(0,n.jsx)("h2",{id:"shared state",children:"Naive solution: shared state"}),(0,n.jsxs)("p",{children:["A first solution: a shared state. You defined a react state at the level of the component that wraps all your viz with ",(0,n.jsx)("code",{children:"useState"}),":"]}),(0,n.jsx)(c.d,{code:B}),(0,n.jsx)("p",{children:"You then pass the state and the setter function to each viz. Something like:"}),(0,n.jsx)(c.d,{code:M}),(0,n.jsx)("p",{children:"Then, for each shape item of the graph you're building, you check wether or not the shape should be highlighted, and changes the way it's rendered if so."}),(0,n.jsxs)("p",{children:["In the example below I slightly increase the opacity, so the"," ",(0,n.jsx)("code",{children:"div"})," as this in its style attribute:"]}),(0,n.jsx)(c.d,{code:T}),(0,n.jsx)("p",{children:"Here is the result for 4 barplots with 1500 items each:"}),(0,n.jsx)(x.$,{vizName:"CrossGraphInteractionSharedState",VizComponent:p,maxWidth:600,height:500,caption:"Four barplots with 1500 groups each. Hovering a group on a chart highlights it on other charts, with very poor performances."}),(0,n.jsx)("p",{children:"As you can see it works, but is very slow."}),(0,n.jsx)("p",{}),(0,n.jsx)("h2",{id:"better",children:"Improving rerendering"})," ",(0,n.jsx)("p",{children:"A first solution: a shared state."}),(0,n.jsx)(x.$,{vizName:"CrossGraphInteractionBetterRender",VizComponent:L,maxWidth:600,height:500,caption:"Four barplots with 3000 groups each. Hovering a group on a chart highlights it on other charts, with very poor performances."}),(0,n.jsx)("p",{children:"Why is it so slow?"}),(0,n.jsx)("p",{}),(0,n.jsx)("h2",{id:"event emitter",children:"Event emitter"}),(0,n.jsx)("p",{children:"Use a context to improve perf"}),(0,n.jsxs)("p",{children:["React documentation about"," ",(0,n.jsx)("a",{href:"https://reactjs.org/docs/context.html",children:"context"})]}),(0,n.jsx)("p",{children:"Context is primarily used when some data needs to be accessible by many components at different nesting levels."}),(0,n.jsxs)("p",{children:["Step 1 is to create the context with ",(0,n.jsx)("code",{children:"createContext"}),"."]}),(0,n.jsxs)("p",{children:["Doc about ",(0,n.jsx)("code",{children:"CustomEvent()"}),":"," ",(0,n.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent",children:"link"}),"Basically you do const catFound = new CustomEvent('animalfound'). catFound is a CustomEvent. You can trigger it with"]}),(0,n.jsx)(x.$,{vizName:"CrossGraphInteractionWithContext",VizComponent:N,maxWidth:600,height:500,caption:"Four barplots with 3000 groups each. Hovering a group on a chart highlights it on other charts, with very poor performances."}),(0,n.jsx)("h2",{id:"conclusion",children:"Conclusion"})," ",(0,n.jsx)("p",{children:"Article explains how to create a performant cross graph interaction using a react context and an event emitter."}),(0,n.jsx)("p",{children:"But there is more even more you should do"}),(0,n.jsxs)("ul",{children:[(0,n.jsx)("li",{children:"use debounce and throttling to avoid too many concurrent re-renders"}),(0,n.jsx)("li",{children:"don't highlight graphs that are outside of the view port"})]}),(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)("hr",{className:"full-bleed  bord er bg-gray-200 mb-3 mt-10"}),(0,n.jsx)(a.Z,{chartFamily:"general"}),(0,n.jsx)("div",{className:"mt-20"}),(0,n.jsx)(l.Z,{})]})}},45993:function(e){e.exports={codeChunckCopyButton:"code-block_codeChunckCopyButton__yPrL_",copyButtonContainer:"code-block_copyButtonContainer__BrX9E"}},63084:function(e){e.exports={tableOfContent:"table-of-content_tableOfContent__jj0Ai",tocItem:"table-of-content_tocItem__osS9X",tocItemActive:"table-of-content_tocItemActive__CGMTh"}},92981:function(e){e.exports={barContainer:"Barplot_barContainer__q5_UI",bar:"Barplot_bar__1RQpu",text:"Barplot_text__5_orG",highlighted:"Barplot_highlighted__fvJOf"}},2141:function(e){e.exports={barContainer:"Barplot_barContainer___9eCT",bar:"Barplot_bar__RTkon",text:"Barplot_text__rH8Y4",highlighted:"Barplot_highlighted__pqfZq"}}},function(e){e.O(0,[2343,7754,8995,7823,8446,8190,3710,2594,9774,2888,179],function(){return e(e.s=75430)}),_N_E=e.O()}]);